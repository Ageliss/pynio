SUBDIRS = test
#define	IHaveSubdirs

MYNAME	= nio.so

NUMPY_DEFS = -I$(PYTHONPKGSDIR)/numpy/core/include

SRCS = niomodule.c
OBJS = niomodule.o
LIBS = $(LIBSEARCH) $(NIOLIB) $(HDFLIB) $(NCDFLIBS) $(HDFEOSLIB)

#if (defined(Linux) || defined(LINUX)) && !defined(linux)
#define linux
#endif

#if (defined(IRIX) || defined(IRIX64))
EXTRA_LIBS = -lX11 -lftn
LN_COMMANDS = $(LD) -shared

#elif defined(SUN)
EXTRA_LIBS = -R /opt/SUNWspro/prod/lib -L/opt/SUNWspro/prod/lib -R /opt/SUNWspro/lib -L/opt/SUNWspro/lib -lfsu -lsunmath -lompstubs -lm -lX11 -lXext
LN_COMMANDS = $(LD) -G
CCOPTIONS = 

#elif defined(AIX)
EXTRA_LIBS = -lm -lc -lxlf90 -lxlf -lxlopt
LN_COMMANDS = $(LD) -bnoquiet -G -bnoentry -bexpall

#elif defined(linux)
EXTRA_LIBS = -L/usr/X11R6/lib -lX11 -lXext -lg2c
LN_COMMANDS = gcc -shared

#elif defined(Darwin)
EXTRA_LIBS = -L/usr/X11R6/lib -lX11 -L/sw/lib -lg2c
LN_COMMANDS = $(CC_LD) -bundle -flat_namespace -undefined suppress
CCOPTIONS = 
#endif

$(MYNAME): $(OBJS)
	$(LN_COMMANDS) -o $(MYNAME) $(OBJS) $(_LIBROOTSEARCH) $(LIBS) $(EXTRA_LIBS)

niomodule.o: niomodule.c niomodule.h
	$(CC) $(NUMPY_DEFS) $(CCOPTIONS) $(PROJECTDEFINES) -O -I../ni/src/ncl $(PYTHONINCSEARCH) $(ALLINCLUDES) -c niomodule.c


InstallTarget($(MYNAME),$(INSTALL_DB),../pyngl/src/$(PYNGLDIR))
InstallTarget($(MYNAME),$(INSTALL_DB),$(PYTHONPKGSDIR)/$(PYNGLDIR))
CleanFilesTarget($(OBJS) $(MYNAME))
